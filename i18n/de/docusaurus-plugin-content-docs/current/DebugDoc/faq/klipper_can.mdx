---
sidebar_position: 4
sidebar_label: CAN-Probleme Sammlung
---

import ImageView from '@site/src/components/ImageView';

import CAN from '@site/i18n/de/docusaurus-plugin-content-docs/current/General/get-id/_get-canbus-uuid.mdx';

# CAN-Probleme Sammlung

## Vorbereitungen vor der Gerätesuche

    * Vor der Suche nach der CAN-ID, bitte [verbinden Sie sich zuerst mit SSH](/docs/DebugDoc/BasicTutorial/index.mdx "Klicken zum Wechseln")
    * Achten Sie darauf, dass Sie sich über das Netzwerk und nicht über die serielle Schnittstelle anmelden
    * Stellen Sie sicher, dass UTOC verbunden oder das Mainboard mit der CAN-Bridge-Firmware gebrannt ist und dass das Datenkabel für die Datenübertragung geeignet ist

## Bestimmen, ob ein Gerät vorhanden ist

    * Jetzt sind Sie erfolgreich in der Host-Maschine eingeloggt und können `lsusb` eingeben, um nach Geräten zu suchen. Es gibt folgende Möglichkeiten:
        * Wenn `lsusb` angibt, dass der `ls`-Befehl nicht gefunden wurde, können Sie den folgenden Befehl verwenden, um das Paket zu installieren:
            ```bash
            sudo apt-get install usbutils
            ```
        * Wenn `lsusb` keine Reaktion zeigt, liegt ein Systemproblem vor, und wir können nichts tun. Sie müssen das System wechseln oder ein funktionierendes System verwenden.
        * Wenn die Informationen wie im Bild unten angezeigt werden, beachten Sie, dass dies nur ein Beispiel ist. Sie müssen sicherstellen, dass `1d50:606f` angezeigt wird:
            <ImageView image={require('@site/docs/General/get-id/img/606f.png').default} size="100%" align="left" />
    * `1d50:606f` gehört zu dem Gerät, das Sie in diesem Fall verwenden werden. Die folgenden Hinweise können ignoriert werden, da Systemprobleme dazu führen könnten, dass sie unvollständig oder gar nicht angezeigt werden.
    * Wenn mehrere `1d50:606f` angezeigt werden, ist es ratsam, eines auszuschließen, da dies die spätere Firmware-Verbindung und das Flashen beeinträchtigen könnte. Bei `FLY MINI PAD` ist es beispielsweise besser, das integrierte UTOC zu verwenden und keine anderen CAN-Bridge-Geräte.
    * Wenn keines angezeigt wird, überprüfen Sie bitte selbst, ob das Datenkabel korrekt angeschlossen ist und die Firmware korrekt gebrannt wurde.

:::warning Hinweis
Nur wenn `1d50:606f` angezeigt wird, können Sie nach der CAN-ID suchen.
:::

## Fehlerbehebung anhand von Fehlermeldungen

    * Hier sind einige häufige Fehlermeldungen:
        * OSError: [Errno 19] No such device
        * can.CanError: Failed to transmit: [Errno 100] Network is down
        * can.CanError: Failed to transmit: [Errno 105] No buffer space available
    * Die erste Meldung bedeutet, dass die Host-Maschine das CAN-Gerät (das Mainboard mit der USB-Bridge-Firmware oder UTOC) nicht finden kann.
    * Die zweite Meldung bedeutet, dass die Host-Maschine CAN0 nicht konfiguriert oder falsch konfiguriert hat.
    * Die dritte Meldung tritt auf, wenn der Puffer der Host-Maschine überläuft oder ein Systemproblem vorliegt.
    * Die zweite und dritte Meldung können durch die untenstehende Konfiguration von CAN0 überprüft werden.
    * Wenn keine ID gefunden wird, schauen Sie bitte am Ende dieser Seite nach.

## Überprüfen, ob die Host-Maschine CAN unterstützt

    * Wenn es sich um eine FLY Host-Maschine handelt, ist dieser Schritt nicht erforderlich.
    * Wenn Ihr System `Ubuntu` ist, benötigen Sie die `Ubuntu-Konfiguration von CAN0`. Dieses Dokument wurde noch nicht aktualisiert.
    * Geben Sie den folgenden Befehl ein, um festzustellen, ob das System CAN unterstützt:

    ```bash
    sudo modprobe can && echo "Ihr Kernel unterstützt CAN" || echo "Ihr Kernel unterstützt CAN nicht"
    ```
    * Wenn Ihr Kernel CAN unterstützt, wird `Ihr Kernel unterstützt CAN` angezeigt; wenn nicht, wird `Ihr Kernel unterstützt CAN nicht` angezeigt.
    * Wenn `Ihr Kernel unterstützt CAN` angezeigt wird, können Sie mit dem nächsten Schritt zur Konfiguration von CAN0 fortfahren.

## Konfiguration von CAN0

    * Dieser Befehl überschreibt die bestehende CAN0-Konfiguration des Systems. Nach der Ausführung muss das System neu gestartet werden.
    * Wählen Sie basierend auf Ihrer Situation eine der Optionen aus.
----
    * Bei einer Bitrate von 1M den folgenden Befehl eingeben:

    ```bash
    sudo /bin/sh -c "cat > /etc/network/interfaces.d/can0" << EOF
        allow-hotplug can0
        iface can0 can static
            bitrate 1000000
            up ifconfig $IFACE txqueuelen 1024
            pre-up ip link set can0 type can bitrate 1000000
            pre-up ip link set can0 txqueuelen 1024
    EOF
    ```
----
    * Bei einer Bitrate von 500K den folgenden Befehl eingeben:

    ```bash
    sudo /bin/sh -c "cat > /etc/network/interfaces.d/can0" << EOF
    allow-hotplug can0
    iface can0 can static
        bitrate 500000
        up ifconfig $IFACE txqueuelen 1024
        pre-up ip link set can0 type can bitrate 500000
        pre-up ip link set can0 txqueuelen 1024
    EOF
    ```

    * Neustart des Geräts:

    ```bash
    sudo reboot
    ```


## Wenn keine ID gefunden wird, beachten Sie Folgendes

    * Wenn Klipper die entsprechende ID konfiguriert hat, müssen Sie die ID in der Systemkonfiguration zuerst deaktivieren, das Gerät ausschalten, den Strom unterbrechen und wieder einschalten oder die Reset-Taste auf dem Mainboard drücken.
    * Stellen Sie sicher, dass die CAN-Baudrate der Host-Maschine mit der des Mainboards, Werkzeugboards usw. übereinstimmt.
    * Sie können den folgenden Code verwenden, um die CAN-Baudrate der Host-Maschine zu überprüfen:
    * Stellen Sie sicher, dass keine Verbindung unterbrochen ist.
    * Zwischen dem Werkzeugboard und dem Gerät (Mainboard mit USB-Bridge-Firmware oder UTOC) sollte ein `120Ω`-Jumper installiert sein.
    * Wenn der `120Ω`-Jumper installiert ist, überprüfen Sie mit einem Multimeter bei völlig abgeschaltetem Gerät, ob der Widerstand zwischen CAN H und CAN L bei etwa `60Ω` liegt.
    * Stellen Sie sicher, dass keine Verbindung unterbrochen ist.

    ```bash
    ip -details link show can0
    ```
    
    * Der markierte Bereich im Bild zeigt die CAN-Baudrate und den Puffer der Host-Maschine.
    * Oben `1024` ist der aktuelle Puffer von CAN0.
    * Unten `1000000` ist die aktuelle Baudrate von CAN0.

    <ImageView image={require('@site/docs/General/get-id/img/details.png').default} size="80%" align="center" />

    * Wenn immer noch keine UUID gefunden wird, überprüfen Sie bitte die folgenden Punkte:

        * Überprüfen Sie, ob das Mainboard oder das CAN-Werkzeugboard korrekt angeschlossen ist.
        * Stellen Sie sicher, dass es ordnungsgemäß versorgt wird. Beim Mainboard wird empfohlen, die VCC-Stromversorgung anzuschließen.
        * Überprüfen Sie, ob die Host-Maschine das CAN-Netzwerk unterstützt.
        * Überprüfen Sie, ob der Widerstand bei etwa `60Ω` liegt.
        * Überprüfen Sie, ob die Firmware korrekt kompiliert wurde.

## ID suchen

    * Geben Sie den folgenden Befehl ein, um die ID zu suchen:
    ```bash
    ~/klippy-env/bin/python ~/klipper/scripts/canbus_query.py can0
    ```
    * Wenn eine ID angezeigt wird und am Ende `Application:` `Klipper` anzeigt, kann diese ID direkt verwendet werden.
    * Wenn eine ID angezeigt wird und am Ende `Application:` `CANBOOT` oder `Katapult` anzeigt, muss die Firmware aktualisiert werden, bevor sie verwendet werden kann.
        <ImageView image={require('@site/docs/General/get-id/img/canbus-uuid.png').default} size="50%" align="left" />