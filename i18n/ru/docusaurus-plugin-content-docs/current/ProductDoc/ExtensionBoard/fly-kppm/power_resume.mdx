---
sidebar_position: 2
---

# Восстановление печати после отключения питания в Klipper

:::danger Обратите внимание

* Подходит только для некоторых машин

:::

## Переключение ветки
    * Необходимо подключиться к верхнему компьютеру через SS по сети, убедитесь, что верхний компьютер имеет доступ в интернет
    ```bash
    git clone https://e.coding.net/g-ofpa1390/3D-Printers/klipper-dev.git -b fly-dev klipper
    ```

## Справочная конфигурация

    ```cfg
    [power_resume]
    power_pin: PA10
    is_shutdown: True # Выполнять операцию выключения, по умолчанию включено
    start_gcode:
        # G-code для выполнения перед восстановлением печати
        # Все параметры, сохраненные перед отключением питания, можно получить через {PR}
        # Можно использовать M118 {PR} для вывода всех доступных параметров
        M118 Начало восстановления печати: {PR.print_stats.filename}
        {% if PR.print_stats.info.total_layer %}
            M118 Всего слоев: {PR.print_stats.info.total_layer}
            M118 Прерванный слой: {PR.print_stats.info.current_layer}
        {% endif %}
        M118 Прерванная позиция: X:[{PR.POS_X}] Y:[{PR.POS_Y}] Z:[{PR.POS_Z}] E:[{PR.POS_E}]
        M140 S{PR.bed.target}      ; Установка температуры стола
        # M104 S180                ; Установка температуры экструдера
        # M109 S180                ; Ожидание нагрева экструдера до заданной температуры
        G91                        ; Относительные координаты
        G1 Z2 F100                 ; Поднятие Z для подготовки к возврату XY
        G90                        ; Абсолютные координаты
        G28 X Y                    ; Возврат XY
        M140 S{PR.bed.target}      ; Установка температуры стола
        M104 S{PR.extruder.target} ; Установка температуры экструдера
        M190 S{PR.bed.target}      ; Ожидание нагрева стола до заданной температуры
        M109 S{PR.extruder.target} ; Ожидание нагрева экструдера до заданной температуры
        M106 S255                  ; Включение вентилятора для охлаждения
        M83                        ; Относительная экструзия
        G1 E10 F400                ; Экструзия небольшого количества
        G90                        ; Абсолютные координаты
        G1 F{PR.gcode_move.speed}  ; Установка скорости перемещения
        G1 X{PR.POS_X} Y{PR.POS_Y} Z{PR.POS_Z} ; Перемещение к начальной позиции
        {% if PR.gcode_move.absolute_coordinates %}
            G90 ; Абсолютное движение
        {% else %}
            G91 ; Относительное движение
        {% endif %}
        {% if PR.gcode_move.absolute_extrude %}
            M82 ; Абсолютная экструзия
        {% else %}
            M83 ; Относительная экструзия
        {% endif %}
        G92 E{PR.POS_E} ; Установка позиции экструзии
    shutdown_gcode:
        # G-code для выполнения перед выключением
        M118 Низкое напряжение питания, выключение
        # M112 ; Экстренная остановка
    ```